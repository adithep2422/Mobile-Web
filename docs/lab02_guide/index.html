<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KKU Campus Guide — แนะนำสถานที่ภายในมหาวิทยาลัยขอนแก่น</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container header-inner">
            <div class="brand">
                <img src="img/KKU Campus Guide Educational Logo.png" alt="KKU Logo" class="logo-image">
                <div>
                    <h1>KKU Campus Guide</h1>
                    <p class="subtitle">แนะนำสถานที่ภายในมหาวิทยาลัยขอนแก่น</p>
                </div>
            </div>
            <!-- CTA moved below header and placed above suggested places -->
            <p class="student-info">รหัสนักศึกษา: <strong>663380242-9</strong> | ชื่อ-สกุล: <strong>อดิเทพ มานันที</strong></p>
        </div>
    </header>

    <main class="container main-content">
        <div class="top-cta-row">
            <button id="showFormBtn" class="btn-primary top-cta" aria-expanded="false" aria-controls="placeForm">แนะนำสถานที่</button>
        </div>
        <section id="library" class="place">
            <h2>หอสมุดกลาง</h2>
            <p class="lead">หอสมุดกลางเป็นแหล่งทรัพยากรการเรียนรู้และอ่านหนังสือ มีมุมอ่านหนังสือ ห้องคอมพิวเตอร์ และบริการยืม-คืนที่สะดวก</p>
            <div class="gallery">
                <figure>
                    <img src="https://library.kku.ac.th/wp-content/uploads/2022/04/1.png" alt="หอสมุดกลาง ภายนอก" loading="lazy">
                </figure>
                <figure>
                    <img src="https://pbs.twimg.com/media/DtPkAwqVAAAI8xH.jpg" alt="ภายในหอสมุด เหมาะสำหรับการอ่าน" loading="lazy">
                </figure>
            </div>
        </section>

        <section id="sports" class="place">
            <h2>สนามกีฬากลาง</h2>
            <p class="lead">สนามกีฬากลางรองรับกิจกรรมหลากหลาย เหมาะสำหรับนักศึกษาและบุคลากร</p>
            <div class="gallery">
                <figure>
                    <img src="https://tidkobsanam.weebly.com/uploads/2/5/0/3/25034254/6394000_orig.jpg" alt="สนามฟุตบอล มุมกว้าง" loading="lazy">
                </figure>
                <figure>
                    <img src="https://sports.kku.ac.th/wp-content/uploads/2025/05/482245370_968194518820291_6617541485473203609_n-768x768.jpg" alt="สนามกีฬา อาคารกีฬาในร่ม" loading="lazy">
                </figure>
            </div>
        </section>

        <section id="food" class="place">
            <h2>ศูนย์อาหารและบริการ</h2>
            <p class="lead">ศูนย์อาหารรวบรวมร้านอาหารหลากหลายราคาย่อมเยา เป็นจุดที่นักศึกษาชอบมาพบปะและเติมพลังงานระหว่างวัน</p>
            <div class="gallery">
                <figure>
                    <img src="https://asset.kku.ac.th/wp-content/uploads/2022/04/6-1024x683.jpg" alt="ศูนย์อาหารและบริการ 1 (คอมเพล็กซ์)" loading="lazy">
                </figure>
                <figure>
                    <img src="https://asset.kku.ac.th/wp-content/uploads/2022/05/2022-05-11_06-53-05_176797-1024x768.jpg" alt="ศูนย์อาหารและบริการ 2 (โรงชาย)" loading="lazy">
                </figure>
            </div>
        </section>

        <section id="garden" class="place">
            <h2>สวนเกษตร</h2>
            <p class="lead">สวนสาธารณะและพื้นที่สีเขียวเหมาะสำหรับการพักผ่อน เดินเล่น หรือวิ่งออกกำลังกาย</p>
            <div class="gallery">
                <figure>
                    <img src="https://iad.kku.ac.th/upload/photo/web/pF9QsXKK.jpg" alt="สวนเกษตร 1" loading="lazy">
                </figure>
                <figure>
                    <img src="https://ddq1mzvkg4fn7.cloudfront.net/2023/09/LINE_ALBUM_--------------_230905_5.jpg" alt="สวนเกษตร 2" loading="lazy">
                </figure>
            </div>
        </section>
    </main>

    <!-- Modal overlay for place recommendation form -->
    <div id="modalOverlay" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal" role="document">
            <header>
                <h3 id="modalTitle">แนะนำสถานที่ใหม่</h3>
                <button class="modal-close" id="modalCloseBtn" aria-label="ปิด">✗</button>
            </header>
            <div class="modal-body">
                <form id="modalForm" class="modal-form" action="https://api.web3forms.com/submit" method="POST" novalidate>
                    <input type="hidden" name="access_key" value="b7bdbc58-f236-4770-8558-f100c128023b">
                    <div id="formError" class="form-error hidden" role="alert" aria-live="polite">กรุณากรอกข้อมูลให้ครบถ้วน (ชื่อสถานที่, รายละเอียด และ URL รูปภาพอย่างน้อย 1 รายการ)</div>

                    <div class="form-row">
                        <label for="m_placeName">ชื่อสถานที่</label>
                        <input id="m_placeName" name="place_name" type="text" required placeholder="เช่น หอศิลป์ KKU">
                    </div>

                    <div class="form-row">
                        <label for="m_placeDesc">รายละเอียด</label>
                        <textarea id="m_placeDesc" name="place_description" rows="3" required placeholder="คำอธิบายสั้น ๆ"></textarea>
                    </div>

                    <div class="form-row">
                        <label>URLs ของรูปภาพ (ถ้ามี)</label>
                        <div id="imageInputs" class="image-inputs">
                            <div class="image-row">
                                <input id="m_placeImage" name="place_image[]" type="url" placeholder="https://example.com/photo.jpg">
                                <button type="button" class="btn-secondary remove-image hidden" aria-label="ลบรูป">−</button>
                            </div>
                        </div>
                        <div style="margin-top:8px">
                            <button type="button" id="addImageBtn" class="btn-secondary">เพิ่มรูปภาพ</button>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" id="modalSubmit" class="btn-primary">ส่งการแนะนำ</button>
                        <button type="button" id="modalCancelBtn" class="btn-secondary">ยกเลิก</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="container">
            <p>KKU Campus Guide — แนะนำสถานที่ภายในมหาวิทยาลัยขอนแก่น</p>
        </div>
    </footer>
    </footer>
    <script>
        (function(){
            const showBtn = document.getElementById('showFormBtn');
            const overlay = document.getElementById('modalOverlay');
            const closeBtn = document.getElementById('modalCloseBtn');
            const cancelBtn = document.getElementById('modalCancelBtn');
            const form = document.getElementById('modalForm');
            const firstField = document.getElementById('m_placeName');
            const addImageBtn = document.getElementById('addImageBtn');
            const imageInputs = document.getElementById('imageInputs');
            const submitBtn = document.getElementById('modalSubmit');

            function openModal(){
                overlay.classList.remove('hidden');
                overlay.focus();
                setTimeout(()=> firstField && firstField.focus(),50);
            }
            function resetForm(){
                if(!form) return;
                form.reset();
                // remove extra image rows (keep first)
                if(imageInputs){
                    const rows = imageInputs.querySelectorAll('.image-row');
                    rows.forEach((r,i)=>{ if(i>0) r.remove(); });
                    const firstRemove = imageInputs.querySelector('.remove-image');
                    if(firstRemove) firstRemove.classList.add('hidden');
                }
                updateSubmitState();
            }
            function closeModal(){
                overlay.classList.add('hidden');
                resetForm();
                if(showBtn) showBtn.focus();
            }

            function updateSubmitState(){
                // clear error when user types or modifies image inputs
                const errEl = document.getElementById('formError');
                if(errEl && !errEl.classList.contains('hidden')) errEl.classList.add('hidden');
            }

            if(showBtn){
                showBtn.addEventListener('click', openModal);
            }
            if(closeBtn){
                closeBtn.addEventListener('click', closeModal);
            }
            if(cancelBtn){
                cancelBtn.addEventListener('click', closeModal);
            }

            // listen for input changes to enable/disable submit
            ['m_placeName','m_placeDesc'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.addEventListener('input', updateSubmitState);
            });

            // Add image input row
            if(addImageBtn){
                addImageBtn.addEventListener('click', function(){
                    const row = document.createElement('div');
                    row.className = 'image-row';
                    const input = document.createElement('input');
                    input.type = 'url';
                    input.name = 'place_image[]';
                    input.placeholder = 'https://example.com/photo.jpg';
                    input.className = '';
                    const remove = document.createElement('button');
                    remove.type = 'button';
                    remove.className = 'btn-secondary remove-image';
                    remove.textContent = '−';
                    remove.setAttribute('aria-label','ลบรูป');
                    remove.addEventListener('click', function(){ row.remove(); });
                    row.appendChild(input);
                    row.appendChild(remove);
                    imageInputs.appendChild(row);
                    // show remove buttons once more than one
                    Array.from(imageInputs.querySelectorAll('.remove-image')).forEach(b=>b.classList.remove('hidden'));
                });
            }

            // Delegate remove clicks (covers dynamically added too)
            imageInputs.addEventListener('click', function(e){
                if(e.target && e.target.matches && e.target.matches('.remove-image')){
                    const row = e.target.closest('.image-row');
                    if(row) row.remove();
                    // hide remove if only one row left
                    const rows = imageInputs.querySelectorAll('.image-row');
                    if(rows.length === 1){
                        const btn = imageInputs.querySelector('.remove-image');
                        if(btn) btn.classList.add('hidden');
                    }
                }
            });

            overlay.addEventListener('click', function(e){
                if(e.target === overlay) closeModal();
            });

            document.addEventListener('keydown', function(e){
                if(e.key === 'Escape' && !overlay.classList.contains('hidden')){
                    closeModal();
                }
            });

            // handle submit: validate required fields and prevent submission when invalid
            if(form){
                form.addEventListener('submit', function(e){
                    const name = (document.getElementById('m_placeName')?.value || '').trim();
                    const desc = (document.getElementById('m_placeDesc')?.value || '').trim();
                    const err = document.getElementById('formError');

                    // check at least one non-empty image URL
                    let hasImage = false;
                    if(imageInputs){
                        const inputs = imageInputs.querySelectorAll('input[name="place_image[]"]');
                        inputs.forEach(i => { if((i.value || '').trim().length > 0) hasImage = true; });
                    }

                    if(!(name.length > 0 && desc.length > 0 && hasImage)){
                        e.preventDefault();
                        if(err) err.classList.remove('hidden');
                        if(!name) document.getElementById('m_placeName').focus();
                        else if(!desc) document.getElementById('m_placeDesc').focus();
                        else if(!hasImage){
                            // focus first image input
                            const firstImg = imageInputs?.querySelector('input[name="place_image[]"]');
                            if(firstImg) firstImg.focus();
                        }
                        return;
                    }
                    // prevent double-submit by disabling button after successful validation
                    if(submitBtn) submitBtn.disabled = true;
                });
                // hide error when user types in any image input
                if(imageInputs){
                    imageInputs.addEventListener('input', function(){
                        const err = document.getElementById('formError');
                        if(err && !err.classList.contains('hidden')) err.classList.add('hidden');
                    });
                }
            }

            // initial state
            updateSubmitState();
        })();
    </script>
</body>
</html>